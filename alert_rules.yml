groups:
  - name: weather_service_alerts
    rules:
      # Critical: Error Rate SLI Breach
      - alert: HighErrorRate
        expr: |
          sum(rate(weather_service_http_requests_total{code=~"5.."}[5m])) 
          / 
          sum(rate(weather_service_http_requests_total[5m])) > 0.05
        for: 2m
        labels:
          severity: critical
          team: sre
        annotations:
          summary: "Service {{ $labels.instance }} error rate is > 5%"
          description: "The weather service is failing more than 5% of requests. This affects the Error Budget."

      # Warning: Latency SLI Breach (P99)
      - alert: SlowResponses
        expr: histogram_quantile(0.99, sum by (le) (rate(weather_service_http_request_duration_seconds_bucket[5m]))) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "P99 Latency Breach"
          description: "99th percentile of requests are taking longer than 500ms."